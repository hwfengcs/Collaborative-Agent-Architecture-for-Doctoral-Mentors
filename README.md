# 多Agent博士生指导系统

这是一个基于大语言模型的多Agent交互框架，旨在模拟博士生学术培养环境，帮助博士生完成高水平论文的撰写与发表。系统由博士生、高校导师、企业导师三个主要Agent组成，以及知识获取和论文评估两个辅助模块。系统采用了长期记忆机制，确保在复杂交互过程中保持上下文连贯性。

本系统特别关注实际应用场景和可量化的业务价值，引导博士生在LLM-Agent与互联网数据挖掘的交叉领域进行踏实、务实的创新研究。

## 系统组件

1. **博士生Agent**：模拟一位人工智能专业的博士生，研究方向为LLM-Agent与数据挖掘的交叉领域，注重踏实、务实的创新方法
2. **高校导师Agent**：专注于LLM-Agent方向的学术导师，引导博士生进行系统性、渐进式的理论创新
3. **企业导师Agent**：来自字节跳动的导师，专注于抖音数据挖掘，强调实际应用价值与工程实现
4. **知识获取模块**：包含论文检索和LLM咨询两个子模块，支持深度推理能力
5. **论文评估模块**：评估论文质量并提供修改建议，确保论文符合学术标准
6. **记忆管理系统**：为每个Agent提供长期记忆能力，在多阶段交互中保持上下文连贯性

## 安装依赖

```bash
pip install -r requirements.txt
```

## 运行系统

```bash
python main.py
```

运行系统将启动完整的博士生指导流程，包括：初始化阶段、研究执行阶段、论文撰写阶段、论文优化阶段、定稿发表阶段。在每个阶段结束时，系统会自动生成阶段总结并存储为长期记忆，以便在后续阶段中使用。系统会自动保存交互历史、论文草稿和代理记忆。

系统使用DeepSeek-Chat模型，能够生成严谨、深入的学术内容。系统内置了上下文长度管理和消息序列优化机制，确保在长对话中不会超出模型的最大上下文限制，并符合DeepSeek API的消息格式要求。

## 查看论文

系统运行完成后，最终论文会自动保存为`final_paper.md`文件。你也可以使用`view_paper.py`脚本来查看论文的不同版本：

```bash
# 查看最终论文
python view_paper.py --final

# 列出所有论文版本
python view_paper.py --list

# 查看指定版本的论文
python view_paper.py --version 3
```

## 系统产物

系统运行后会生成以下文件：

- `interaction_history.json`：完整的交互历史
- `paper_drafts.json`：论文所有版本的历史记录
- `final_paper.md`：最终完成的论文
- `memories/`：目录包含各个代理的长期记忆
  - `phd_student_memories.json`：博士生的阶段记忆
  - `academic_advisor_memories.json`：高校导师的阶段记忆
  - `industry_advisor_memories.json`：企业导师的阶段记忆

## 系统架构

系统基于DeepSeek API实现，使用DeepSeek-Chat模型提供强大的对话能力。各Agent之间的交互由AgentCoordinator协调，并通过记忆管理系统保持上下文连贯性：

```ascii
┌─────────────────────────────────────────┐
│            协调管理模块                  │
│  (控制Agent交互流程与信息传递)           │
└───────────────┬─────────────────────────┘
                │
        ┌───────┴───────┐
        │               │
┌───────▼────────┐  ┌───▼───────────────┐
│  博士生Agent   │  │    知识获取模块    │
└───────┬────────┘  │ ┌─────────────┐   │
        │           │ │ 论文检索子模块│   │
┌───────▼───────┐   │ └─────────────┘   │
│ ┌───────────┐ │   │ ┌─────────────┐   │
│ │高校导师Agent│◄──┼─►│ LLM咨询子模块│   │
│ └───────────┘ │   │ └─────────────┘   │
│ ┌───────────┐ │   └───────────────────┘
│ │企业导师Agent│ │
│ └───────────┘ │   ┌───────────────────┐
└───────┬───────┘   │   论文评估模块     │
        │           │ (评估质量与提供修改) │
        └──────────►└───────────────────┘

┌─────────────────────────────────────────┐
│            记忆管理系统                  │
│  (保存阶段总结并在后续阶段注入上下文)     │
└─────────────────────────────────────────┘
```

## 使用说明

1. 在`main.py`文件中设置您的DeepSeek API密钥
2. 运行系统后，您可以查看交互过程和最终生成的论文
3. 查看`memories`目录下的记忆文件，了解各个阶段的关键内容
4. 如需修改Agent的提示词或系统行为，可编辑相应的Agent类文件
5. 系统默认使用DeepSeek-Chat模型，可在`agents/base_agent.py`中修改

## 特色功能

1. **长期记忆机制**：在多阶段交互中保持上下文连贯性，避免LLM窗口限制导致的信息丢失
2. **阶段性总结**：每个阶段结束时自动生成总结，并在后续阶段中注入相关记忆
3. **踏实创新方法**：强调渐进式、基于现有工作的创新，而非天马行空的想象
4. **对话能力增强**：使用DeepSeek-Chat模型提供流畅的对话体验和深入的学术内容
5. **上下文长度管理**：自动管理对话历史长度，避免超出模型的最大上下文限制
6. **消息序列优化**：确保消息序列符合DeepSeek API的格式要求，避免连续的用户或助手消息
7. **记忆内容优化**：智能管理长期记忆内容，在保持关键信息的同时避免上下文过长

## 技术实现

系统在技术实现上注重以下几点：

1. **模型交互优化**：确保与DeepSeek-Chat模型的交互符合其API要求，系统消息始终位于消息序列开头
2. **上下文管理**：通过估算token数量，智能裁剪历史消息，保留最重要的上下文信息
3. **消息序列规范化**：自动检测并修复可能导致API错误的消息序列问题
4. **记忆注入控制**：限制记忆注入的数量和长度，避免上下文溢出
5. **异常处理机制**：完善的错误捕获和处理机制，提高系统稳定性

## 未来计划

1. **多模型支持**：扩展系统以支持更多大语言模型，如GPT-4、Claude等
2. **更精确的token计算**：实现更精确的token计算方法，优化上下文管理
3. **交互式界面**：开发Web界面，提供更友好的用户交互体验
4. **自定义研究领域**：支持用户自定义研究领域和Agent角色
5. **多语言支持**：扩展系统以支持更多语言的论文生成